### Запуск только упавших тестов и кеш `pytest`

**Кеш `pytest`**

- При первом запуске `pytest` создаёт директорию `.pytest_cache` со сведениями о выполненных тестах.
    
- Эти данные позволяют **повторно** запускать только упавшие тесты или отслеживать новые тесты.
    

---

### Ключи для ускорения повтора тестов

1. **`--lf` / `--last-failed`**  
    Запускает **только** тесты, которые **упали** в предыдущем прогоне.
    
    - Полезно, когда много тестов прошли успешно, а вы хотите быстро перепроверить только проблемные.
        
2. **`--ff` / `--failed-first`**  
    Сначала запускаются тесты, упавшие в предыдущем запуске, затем все остальные.
    
    - Удобно, если вы подозреваете, что фиксы в одном месте могут «починить» несколько тестов или, наоборот, что исправление могло сломать что-то другое.
        
3. **`--nf` / `--new-first`**  
    Сначала запускает **новые** тесты — те, что появились (или изменились) с последнего прогона, потом все остальные.
    
    - Сортирует тесты по дате изменения их файлов: «новые» или отредактированные файлы идут первыми.
        

Пример запуска:

```bash
pytest test_example.py -qq --lf
```

- `-qq` (дважды quiet) уменьшает вывод отчёта до минимума.
    
- `--lf` запускает лишь те тесты, которые падали в предыдущем запуске.
    

---

### Режим «остановки» тестов при ошибках

1. **`-x` / `--exitfirst`**  
    Останавливает всё тестирование при первом упавшем тесте.
    
    - Удобно, когда не хочется «пролистывать» гору упавших тестов из-за одной ошибки.
        
2. **`--maxfail=N`**  
    Остановится после **N** упавших тестов.
    
    - Полезно, когда хотите получить список **нескольких** проблем, но не нужно видеть полный завал.
        

**Комбинированные** примеры:

```bash
pytest --ff -x
```

- Сначала запускаем упавшие тесты (**--failed-first**),
    
- Останавливаемся на первом из них (**--exitfirst**).
    

---

### Пошаговый режим (stepwise)

- **`--sw` / `--stepwise`**: запускает тесты по порядку. Если один упал, тестирование прекращается. Исправляете ошибку — повторяете запуск, процесс стартует **с упавшего** теста и идёт дальше.
    
- **`--stepwise-skip`**: можно пропустить упавший тест и продолжить последующие, не возвращаясь к нему в этом же пошаговом режиме.
    

---

### Удаление кеша

- В случае конфликта имен файлов, переименования/перемещения тестов, или при «битом» кеше — можно просто удалить `.pytest_cache/`.
    
- Pytest иногда сам подсказывает, когда есть проблемы с кешем, указывая на расхождения имён файлов.
