**Особенности `pytest`**

- Используется ключевое слово `assert` для проверок (вместо методов `assertEqual` и т. д.).
    
- Тесты можно писать в **функциях** и **классах**.
    
- **Мощные фикстуры** для настройки окружения.
    
- Множество **плагинов** (например, `pytest-xdist` для параллельного запуска, `pytest-django` для Django).
    
- Умеет запускать тесты из `unittest`-подобных файлов.
    

---

### Установка и запуск

```bash
pip install pytest==7.1.2
```

- Файлы с тестами должны начинаться с `test_` или заканчиваться на `_test.py`.
    
- Тестовые функции начинаются с `test_`.
    
- Тестовые методы в классе `Test...` (без `__init__()`), тоже начинаются с `test_`.
    

Пример: файл `test_example.py`:

```python
def one_more(x):
    return x + 1

def test_correct():
    assert one_more(4) == 5

def test_fail():
    assert one_more(3) == 5
```

Запуск тестов:

```bash
pytest
```

Pytest найдёт все тесты, выведет отчёт: прошедшие отмечаются точками (`.`) или зелёными пометками, упавшие — буквами `F` (Fail).

---

### Проверка выброса исключений

```python
import pytest

def division(dividend, divisor):
    return dividend / divisor

def test_zero_division():
    with pytest.raises(ZeroDivisionError):
        division(1, 0)
```

- Если внутри `with pytest.raises(...)` не возникнет указанное исключение — тест упадёт.
    
- Если исключение возникнет, но другого типа — тест тоже упадёт.
    

---

### Пример подробного отчёта (`-v`, `-vv`)

- Запуск тестов с `-v` (или `--verbose`) показывает каждую тестовую функцию отдельной строкой и даёт расширенный вывод о провале.
    
- Если внутри `assert` сравнивается сложная структура (списки, словари), pytest покажет подробный diff, укажет конкретные несоответствия.
    
- `-vv` («двойная подробность») раскрывает ещё больше информации, если при `-v` часть диффа скрывается.
    

**Пример**:

```python
def get_sort_list(string):
    new_list = sorted(string.split(', '))
    return new_list

def test_sort():
    result = get_sort_list('Яша, Саша, Маша, Даша')
    assert result == ['Даша', 'Маша', 'Саша', 'Яша']
```

При несовпадении pytest выдаст детальный diff, советуя добавить `-v` или `-vv`.

---

### Ключи вывода

- `-q` / `--quiet` уменьшает вывод.
    
- `-qq` ещё сильнее скрывает детали, вплоть до отчёта о количестве тестов.
    

---

### Выборочный запуск тестов

Запуск **всех** тестов:

```bash
pytest
```

Запуск тестов **определённого файла**:

```bash
pytest test_example.py
```

Запуск **конкретного теста** по Node ID:

```bash
pytest test_example.py::test_fail
```

Запуск всех тестов **из одного класса**:

```bash
pytest file_name.py::TestClassName
```

Запуск нескольких тестов через пробел:

```bash
pytest test_example.py::test_fail test_example.py::test_correct
```

Запуск **по фильтру имени** (`-k`):

```bash
pytest -k "correct"
```

- Запустит тесты, у которых в имени есть `correct`.
    
- Можно использовать логические операции: `and`, `or`, `not`. Пример:
    
    ```bash
    pytest -k "(django or python) and not javascript"
    ```
    

---

**Best practices**

1. **Понятные имена тестов**: названия функций и классов отражают, что именно проверяется (`test_user_cannot_login_without_password`, `test_sort_returns_alphabetical_order` и т. д.).
    
2. **Мелкие атомарные проверки**: если нужно проверить несколько сценариев одной и той же логики — используйте несколько `test_`-функций.
    
3. **Функции vs. классы**:
    
    - При простой логике можно обойтись функциями без классов.
        
    - Если есть общие фикстуры/настройки, удобно сгруппировать тесты в класс `Test...`.
        
4. **Фикстуры** (`@pytest.fixture`) вместо `setUp()` (unittest-подход): гибче и можно переиспользовать.
    
5. **Контроль вывода**:
    
    - `-v` / `-vv` позволяет лучше диагностировать различия в сложных структурах.
        
    - `-q` / `-qq` полезно при CI-пайплайнах, где нужен короткий лог.
        
6. **Запуск выборочных тестов**: ускоряйте работу, если проверяется определённый кусок кода, — используйте `-k "some_filter"` или `::test_name`.
    
7. **Проверка исключений**: применяйте `pytest.raises(...)`. Не нагромождайте try/except в самих тестах.
    
8. **Документация**: при нестандартных ситуациях (переопределение путей, собственные плагины) читайте официальную документацию pytest — она обширна и детализирована.