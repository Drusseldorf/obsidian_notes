## 1. Режим отладки Django

### 1.1 Флаг `DEBUG=True`

- По умолчанию в период разработки в `settings.py` указано `DEBUG=True`.
- При ошибках Django показывает **«отладочные»** (debug) страницы с техническими деталями (трассировки, локальные переменные).

### 1.2 Отключение режима отладки

- В продакшене обычно задают `DEBUG=False`.
- Вместо подробного дебаг-отчёта пользователи получают **«стандартные»** страницы (400, 403, 404, 500) без детальной тех. информации.
- Django перестаёт раздавать статику (он ожидает, что это делает внешний сервер, например, nginx).
- Нужно также настроить `ALLOWED_HOSTS` – список доменов/адресов, на которых доступен сайт:
    
    ```python
    DEBUG = False
    ALLOWED_HOSTS = ['localhost', '127.0.0.1', 'www.example.com']
    ```
    
- Если не указать ALLOWED_HOSTS, вы получите ошибку:
    
    ```
    CommandError: You must set settings.ALLOWED_HOSTS if DEBUG is False.
    ```
    

---

## 2. Стандартные страницы ошибок в Django

При `DEBUG=False` Django использует **встроенные** страницы ошибок 404, 403, 500 и т. д. Но они выглядят минималистично и не соответствуют дизайну вашего сайта.

---

## 3. Кастомизация страниц ошибок

### 3.1 Общий механизм для 404, 403, 400 и 500

Django имеет **«хендлеры»** (handler404, handler403, handler400, handler500), в которых хранятся пути к вьюшкам для соответствующих ошибок. По умолчанию:

- `handler404 = 'django.views.defaults.page_not_found'`
- `handler403 = 'django.views.defaults.permission_denied'`
- `handler500 = 'django.views.defaults.server_error'`
- `handler400 = 'django.views.defaults.bad_request'`

Можно переопределить их в **корневом `urls.py`** вашего проекта, указав свой путь к кастомному представлению (view).

#### 3.1.1 Пример для 404

- **В `urls.py`**:
    
    ```python
    handler404 = 'core.views.page_not_found'
    ```
    
- **Во `views.py`** приложения `core` (например, `core/views.py`):
    
    ```python
    from django.shortcuts import render
    
    def page_not_found(request, exception):
        return render(request, 'core/404.html', status=404)
    ```
    
- **Шаблон** `core/404.html` (или можно сохранить в другой папке, главное – передать правильный путь в `render()`):
    
    ```html
    {% extends "base.html" %}
    {% block title %}Custom 404{% endblock %}
    
    {% block content %}
      <h1>Страница не найдена</h1>
      <p>Адрес {{ request.path }} отсутствует. Проверьте правильность URL.</p>
      <a href="{% url 'pages:homepage' %}">На главную</a>
    {% endblock %}
    ```
    

Теперь при ошибке 404 Django вызовет `page_not_found()`, вернёт ваш шаблон с кодом 404.

### 3.2 Особая ошибка CSRF (403)

Если пользователь отправляет форму без CSRF-токена, Django генерирует **особую** 403-ошибку, **не** используя `handler403`. Вместо этого смотрит на `CSRF_FAILURE_VIEW` в `settings.py`.

1. **В `settings.py`**:
    
    ```python
    CSRF_FAILURE_VIEW = 'core.views.csrf_failure'
    ```
    
2. **В `views.py`**:
    
    ```python
    def csrf_failure(request, reason=''):
        return render(request, 'core/403csrf.html', status=403)
    ```
    
3. **В шаблоне** `core/403csrf.html`:
    
    ```html
    {% extends "base.html" %}
    {% block content %}
      <h2>Ошибка CSRF (403)</h2>
      <p>Вы, возможно, отправили форму не с этой страницы или без CSRF-токена.</p>
    {% endblock %}
    ```
    

Таким образом, при неправильном/отсутствующем токене CSRF пользователь увидит ваш дизайн вместо стандартной системы.

---

## 4. Советы и общие бест-практики

1. **Создавайте отдельное приложение** (например, `core`), где хранить кастомные view для ошибок (page_not_found, server_error и пр.) и соответствующие шаблоны (`templates/core/404.html`).
2. **Не забудьте проверить работу**:
    - Попробуйте открыть несуществующую страницу. В режиме `DEBUG=False` должен выводиться ваш шаблон.
    - Попробуйте сымитировать 403, 500. Обычно 500 тестируют, вызвав ошибку или используя специальный «отладочный» view.
3. **Философия** 404 vs. 403:
    - Иногда лучше выдавать 404 вместо 403, чтобы скрыть существование ресурса. Но всё зависит от логики безопасности.
4. **Содержимое**:
    - На странице ошибки желательно дать пользователю удобную ссылку: «Вернуться на главную», «Вернуться назад», «Обратиться в поддержку» и т.д.
5. **Статические файлы**:
    - При `DEBUG=False`, Django не раздаёт статику по умолчанию. В продакшене обычно статику и медиа-файлы обслуживает nginx/Apache.
    - При локальной проверке кастомных 404/403 иногда приходится включать `DEBUG=False` и всё равно настроить «раздачу» статики (например, через `runserver --insecure` или другие способы).
6. **Серверные ошибки 500 и 400**:
    - Ими управляют `handler500` и `handler400`. По тому же принципу переопределяйте в `urls.py`:
        
        ```python
        handler500 = 'core.views.server_error'
        handler400 = 'core.views.bad_request'
        ```
        
    - Создайте `server_error(request)` / `bad_request(request, exception)` в `core/views.py`.