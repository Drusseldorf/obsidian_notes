# 11.20 Сортировка данных

### Сортировка данных

### Основные принципы сортировки

При выполнении обычного `SELECT` запросов порядок строк в результирующей таблице не гарантируется. Для того чтобы упорядочить данные, используется ключевое слово `ORDER BY`, за которым следует колонка, по которой необходимо выполнить сортировку.

Примеры:

```sql
SELECT * FROM author ORDER BY name;
SELECT * FROM author ORDER BY id;
SELECT * FROM author ORDER BY id ASC; -- по возрастанию (по умолчанию)
SELECT * FROM author ORDER BY id DESC; -- по убыванию
SELECT * FROM author ORDER BY description;
```

### Сортировка по порядку колонок

Вместо указания имени колонки, по которой нужно сортировать, можно использовать её порядковый номер в блоке `SELECT`. Первая колонка соответствует 1, вторая — 2, и так далее.

Пример:

```sql
SELECT author_id, name, description
FROM author
ORDER BY 1; -- сортировка по `author_id`
```

### Сортировка с учетом `NULL` значений

По умолчанию значения `NULL` появляются в конце отсортированного списка. Однако, можно указать, чтобы `NULL` значения шли в начале или в конце с помощью `NULLS FIRST` или `NULLS LAST`.

Пример:

```sql
SELECT author_id, name, description
FROM author
ORDER BY description NULLS FIRST; -- `NULL` значения будут в начале
```

### Сортировка по нескольким колонкам

Можно сортировать данные сразу по нескольким колонкам. В этом случае данные будут сначала отсортированы по первой колонке, а затем внутри каждой группы значений первой колонки — по второй, и так далее.

Примеры:

```sql
SELECT * FROM author_tmp ORDER BY first_name, last_name;
-- Сначала сортировка по `first_name`, затем по `last_name` внутри каждой группы.

SELECT * FROM author_tmp ORDER BY first_name, last_name DESC;
-- Сначала сортировка по `first_name`, затем по `last_name` в порядке убывания.
```

### Сортировка значений из `VALUES`

Сортировка работает также и с данными, заданными через `VALUES`, и с использованием алиасов для колонок.

Пример:

```sql
SELECT * FROM (VALUES ('Яблоко'), ('Апельсин'), ('Банан')) ORDER BY 1;

SELECT * FROM (
    VALUES
        ('Яблоко'),
        ('Апельсин'),
        ('Банан')
) AS t (fruit) ORDER BY fruit;
```

### Дополнения и уточнения

1. **Сортировка без указания `ASC` или `DESC`:** По умолчанию сортировка производится в порядке возрастания (`ASC`), поэтому можно опускать этот ключ, если требуется сортировка по возрастанию.
2. **Использование индексов:** В больших таблицах для ускорения сортировки рекомендуется создавать индексы на колонках, по которым часто выполняется сортировка.
3. **Сортировка по выражениям:** Можно сортировать не только по колонкам, но и по выражениям. Например:
    
    ```sql
    SELECT * FROM author ORDER BY LENGTH(name); -- сортировка по длине имени
    ```
    
4. **Сортировка и производительность:** Сортировка может быть затратной по времени операцией, особенно при большом объеме данных. Важно учитывать это при проектировании запросов, которые должны обрабатывать большие объемы данных.