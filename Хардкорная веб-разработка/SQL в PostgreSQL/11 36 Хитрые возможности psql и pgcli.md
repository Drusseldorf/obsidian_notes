# 11.36 Хитрые возможности psql и pgcli

`psql` — это мощная командная оболочка PostgreSQL, которая предоставляет множество возможностей для работы с базой данных. Рассмотрим некоторые полезные команды и трюки.

### Просмотр списка баз данных

Чтобы увидеть все базы данных в кластере, используйте команду:

```sql
\l
```

Для расширенной информации, включая размер баз данных, можно использовать:

```sql
\l+
```

### Сохранение результата запроса в файл

Для экспорта результатов запроса в CSV-файл используйте команду `\copy`:

```sql
\copy (SELECT * FROM author) TO '~/authors.csv' WITH CSV HEADER
```

После этого вы можете просмотреть содержимое файла командой `bat` или любым другим текстовым просмотрщиком:

```bash
bat ~/authors.csv
```

### Вывод результатов запроса в файл

Для того чтобы сохранить вывод запросов в файл, используйте команду `\o`:

```sql
\o ~/output.txt
```

Все последующие результаты запросов будут записываться в файл. Чтобы снова выводить результаты в терминал, выполните:

```sql
\o
```

### Вывод в формате HTML

psql может выводить результаты запросов в формате HTML:

```sql
\html
SELECT * FROM author;
\o ~/output.html
\html
```

После выполнения этих команд результат будет записан в файл `output.html`. Для отключения режима HTML выполните `\html` снова.

### Просмотр ролей и прав пользователей

Чтобы увидеть список всех пользовательских ролей, используйте команду:

```sql
\du
```

Для показа системных ролей:

```sql
\duS
```

### Редактирование запросов во внешнем редакторе

Если запрос длинный, его можно редактировать во внешнем текстовом редакторе:

```sql
\e
```

После сохранения и выхода из редактора запрос автоматически выполнится.

### Справка по SQL-операторам

Для получения справки по любому SQL-оператору используйте:

```sql
\h select
\h delete
\h create table
```

### Вывод результатов в виде строк

Когда в результатах запроса много столбцов, удобнее выводить их в виде строк:

```sql
\x
SELECT * FROM book;
\x
```

### Сохранение истории команд

Чтобы сохранить историю команд сессии в файл, используйте:

```sql
\s ~/file.sql
```

Это полезно для переноса команд в проект или для сохранения логов работы с базой данных.