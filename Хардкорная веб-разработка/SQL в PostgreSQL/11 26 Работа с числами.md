# 11.26 Работа с числами

В PostgreSQL встроенные типы данных можно разделить на несколько категорий, включая числовые типы данных. Числовые типы данных делятся на целочисленные и нецелочисленные.

### Основные группы типов данных в PostgreSQL:

1. **Числовые типы данных** — целочисленные и нецелочисленные.
2. **Символьные типы данных** — для работы с текстом и строками.
3. **Типы данных для даты и времени** — для хранения дат и временных отметок.
4. **Логический тип данных** — `boolean`, который хранит значения `true` или `false`.
5. **Другие типы данных** — например, BLOB, UUID, массивы, JSON, JSONB, HStore и другие.

### Целочисленные типы данных

В PostgreSQL есть три основных целочисленных типа:

- **`smallint`**:
    - Занимает 2 байта.
    - Хранит числа в диапазоне от  -`32 768` до `32 767`.
- **`int`** (также известен как `integer`):
    - Занимает 4 байта.
    - Хранит числа в диапазоне от  -`2 147 483 648` до `2 147 483 647`.
- **`bigint`**:
    - Занимает 8 байт.
    - Хранит числа в диапазоне от  -`9 223 372 036 854 775 808` до `9 223 372 036 854 775 807`.

### Нецелочисленные типы данных

Для хранения нецелых чисел в PostgreSQL используются следующие типы данных:

- **`REAL`**:
    - Занимает 4 байта.
    - Число с плавающей запятой, приблизительно точное до 6-7 знаков.
- **`DOUBLE PRECISION`**:
    - Занимает 8 байт.
    - Число с плавающей запятой, приблизительно точное до 15 знаков.

**Важно**: Типы `REAL` и `DOUBLE PRECISION` могут давать ошибки округления, поэтому они не всегда подходят для точных вычислений. Например, при работе с деньгами, где точность крайне важна, рекомендуется использовать тип `NUMERIC`.

- **`NUMERIC`**:
    - Этот тип данных используется для хранения чисел с фиксированной точностью и масштабом.
    - **Точность** (precision) определяет общее количество значащих цифр.
    - **Масштаб** (scale) определяет количество цифр после десятичной точки.
    
    Пример:
    
    ```sql
    CREATE TABLE payment (
        payment_id bigint GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
        advertiser_id bigint REFERENCES advertiser NOT NULL,
        amount numeric(10,2) CHECK (amount > 0)
    );
    ```
    
    Здесь `amount numeric(10,2)` означает, что могут быть сохранены до 10 значащих цифр, из которых 2 находятся после запятой.
    

### Примеры работы с `NUMERIC`:

- Пример 1:
    
    ```sql
    SELECT 1::numeric(5,2);    -- 1.00
    SELECT 12::numeric(5,2);   -- 12.00
    SELECT 123::numeric(5,2);  -- 123.00
    SELECT 1234::numeric(5,2); -- Ошибка — нужна точность 6
    ```
    
- Пример 2:
    
    ```sql
    SELECT 1234::numeric(5);   -- 1234 (без десятичной части)
    SELECT 1234::numeric(5,0); -- 1234
    ```
    
- Пример 3:
    
    ```sql
    SELECT 123.45::numeric(5,2); -- 123.45
    SELECT 1.2345::numeric(5,2); -- 1.23
    SELECT 1.111::numeric(5,2);  -- 1.11
    ```
    
- Пример 4:
    
    ```sql
    SELECT sin(21.53::numeric(5,2)); -- 0.44497699751811676 (синус числа)
    SELECT sin(21.53)::numeric(5,2); -- 0.44
    ```
    

### Приведение типов данных

Для приведения значений к другому типу данных можно использовать два двоеточия `::`.

Пример использования:

- **Функция `pg_typeof`** возвращает тип данных переданного ей значения:
    
    ```sql
    SELECT pg_typeof(2);         -- integer
    SELECT pg_typeof('2'::int);  -- integer
    SELECT 1 + '2'::int;         -- 3
    ```