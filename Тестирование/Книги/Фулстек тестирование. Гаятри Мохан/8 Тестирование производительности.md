### 1. Главная идея главы

- **Значимость производительности:** В эпоху цифровых сервисов задержки в работе веб-приложений приводят к падению продаж и потере лояльности клиентов.
- **Раннее тестирование:** Планирование и проверка производительности должны быть встроены в ранние этапы разработки и CI, чтобы вовремя обнаруживать проблемы и устранять их.

---

### 2. Производительность бэкенда: основы

#### 2.1. Почему это важно?

- **Уход клиентов:** Низкая производительность отпугивает пользователей (возрастает доля отказов).
- **Потери для бизнеса:** Длительные отклики и сбои приводят к потерям в продажах и репутационных издержках.
- **Пример:** Низкая скорость сайта Amazon в «Prime Day» стоила миллионов долларов.

#### 2.2. Ключевые показатели эффективности (KPI)

1. **Время отклика (Response Time):** время, за которое сервис обрабатывает запрос.
2. **Пропускная способность (Throughput):** количество запросов, обслуживаемых в секунду/час.
3. **Количество одновременно работающих пользователей:** сколько пользователей система может обслуживать, сохраняя приемлемое время отклика.
4. **Доступность (Availability):** способность приложения работать без сбоев в течение заданного периода.

#### 2.3. Типы тестов производительности

1. **Нагрузочные (Load / Volume) тесты:** проверка, как система ведёт себя при ожидаемом уровне нагрузки.
2. **Стресс-тесты:** постепенное увеличение нагрузки, пока не достигнется точка деградации или отказа.
3. **Тесты на отказоустойчивость (Soak / Endurance):** долгосрочная нагрузка, чтобы выявить утечки памяти и другие эффекты накопления.

#### 2.4. Шаблоны нагрузки

- **Плавное нарастание (Ramp-up):** количество пользователей растёт медленно, затем некоторое время удерживается.
- **Ступенчатое нарастание:** нагрузка увеличивается дискретно (шагами) через определённые интервалы.
- **«Пик – пауза»:** периодические подъёмы (пики) и спады, характерные для циклов активности.

#### 2.5. Этапы тестирования производительности

1. **Определение целей и KPI** (учёт данных бизнеса, конкурентов, прогнозов трафика).
2. **Описание сценариев** (учитывая реальное поведение, время на размышление пользователей и т. д.).
3. **Подготовка среды**, максимально похожей на боевую (сходный объём машин, сети, конфигурации).
4. **Настройка тестовых данных**, близких к реальным (количество, распределение, разнообразие).
5. **Интеграция мониторинга** (New Relic, Dynatrace, Datadog) для отладки узких мест.
6. **Написание сценариев и запуск тестов** (выбор инструментов — JMeter, Gatling, k6, ab и т. д.).

#### 2.6. Инструменты для тестирования производительности бэкенда

- **JMeter:** классический инструмент с GUI, поддерживает нагрузочные и стресс-тесты, возможность интеграции в CI.
- **Gatling:** язык DSL (Scala), удобен для масштабных сценариев.
- **Apache Benchmark (ab):** простой CLI-инструмент для быстрой оценки пропускной способности.

---

### 3. Производительность фронтенда: основы

#### 3.1. Почему тестировать и фронтенд?

- **Время рендеринга в браузере:** 80–90% времени загрузки страницы уходит на отрисовку UI, загрузку скриптов, стиль и т. д.
- **Модель RAIL:** (Response, Animation, Idle, Load) – помогает ставить чёткие цели (ответ пользователю <100мс, время загрузки <1с и т. д.).

#### 3.2. Факторы, влияющие на производительность UI

1. **Сложность JS/CSS и количество HTTP-запросов:** слишком большие и многочисленные файлы замедляют загрузку.
2. **Сети доставки контента (CDN):** размещение статических ресурсов ближе к пользователю снижает задержку.
3. **DNS-запросы и пропускная способность сети:** на время загрузки влияет и скорость канала (Wi-Fi, 3G, 4G).
4. **Кэширование в браузере:** влияет на последующие посещения.

#### 3.3. Ключевые показатели UI

- **Time to First Contentful Paint (FCP):** когда пользователь видит первый элемент на странице.
- **Time to Interactive (TTI):** когда страница становится интерактивной (все скрипты загружены).
- **Largest Contentful Paint (LCP):** время отображения главного элемента (например, основного заголовка).
- **Cumulative Layout Shift (CLS):** величина непредвиденных смещений элементов страницы.

---

### 4. Инструменты для тестирования производительности UI

1. **WebPageTest:** онлайн-сервис, который эмулирует реальный браузер (включая местоположение, тип устройства, скорость сети). Выдаёт отчёты с временем до отрисовки, waterfall-графиками.
2. **Lighthouse (Google Chrome / CLI):** встроенный в Chrome инструмент, проверяющий производительность, безопасность, SEO и т. д. Генерирует отчёты по ключевым метрикам UI, возможно интегрировать в CI.
3. **PageSpeed Insights:** совмещает результаты лабораторных тестов (Lighthouse) и реальные данные (RUM) для выявления узких мест.
4. **Chrome DevTools:** вкладка Performance позволяет записать и анализировать поведение браузера, включая скрипты, задержки при рендере, FPS-анимации.

---

### 5. Общая стратегия тестирования производительности (ранний подход)

1. **Планирование:**
    - Сформулировать KPI на основе бизнес-требований.
    - Заранее подготовить отдельную среду для теста производительности, аналогичную боевой.
2. **Разработка:**
    - Интегрировать простые тесты отклика сервисов (SAST, базовые нагрузочные) в CI.
    - Применять Lighthouse / DevTools для проверки производительности UI при каждой фиче.
3. **CI:**
    - Регулярно запускать тесты производительности API (JMeter, Gatling) и UI (Lighthouse, WebPageTest).
    - Анализировать тенденции, вводить алерты при деградации.
4. **Исследовательское тестирование:**
    - Проверять поведение приложения под нештатными условиями (низкая пропускная способность, задержки, различные устройства).
5. **Перед релизом (сквозные тесты):**
    - Выполнять стресс-тесты, тесты на отказоустойчивость, долгосрочные нагрузки.
    - Анализировать результаты мониторинга (Datadog, New Relic) и оптимизировать слабые звенья.

---

### 6. Ключевые выводы

- **Производительность – критический фактор успеха:** Медленные сайты теряют клиентов и выручку, быстро откликающиеся – повышают продажи.
- **Тестировать как бэкенд, так и UI:** Инструменты нагрузочного тестирования (JMeter, Gatling) не учитывают рендеринг браузера, для UI нужны Lighthouse, WebPageTest и т. п.
- **Непрерывная оценка:** Встраивайте тесты производительности в конвейер CI, чтобы рано обнаруживать деградацию.
- **RAIL-модель:** Сосредоточьтесь на взаимодействии с пользователем, оптимизируя отклики <100 мс и общее время загрузки.
- **Подход "раннее тестирование":** Избегайте ситуации, когда проблемы производительности всплывают перед релизом и заставляют команду устранять их в форс-мажорном режиме.