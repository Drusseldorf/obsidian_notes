### Зачем нужен свой Docker-образ

1. **Нехватка готовых решений**: в публичных репозиториях может не оказаться нужного компонента или службы.
2. **Контейнеризация своего приложения**: упрощает тестирование, доставку и развертывание.
3. **CICD-конвейеры**: возможность собрать собственное уникальное окружение (например, для компиляции) и использовать его в автоматических процессах.

---

### Пример: контейнеризация простого приложения на Python + Flask

- Базовая ОС (например, Ubuntu).
- Установка Python и зависимостей (через `apt` и `pip`).
- Скопировать исходный код (внутрь контейнера, например, в `/opt`).
- Настроить точку входа (запуск Flask-приложения).

Этот план вручную превращается в инструкции внутри `Dockerfile`.

---

### Общая схема создания Docker-образа

4. **Создать `Dockerfile`**:
    - Указать базовый образ (через инструкцию `FROM`).
    - Прописать команды установки зависимостей (через `RUN`).
    - Скопировать файлы приложения (через `COPY`).
    - Определить точку входа для запуска (через `ENTRYPOINT` или `CMD`).
5. **Собрать образ**:
    
    `docker build . -t <имя_образа>`
	    или
	    
		docker build . -f Dockerfile -t webapp-rockets
    
    - `.` указывает на текущую директорию, где лежит `Dockerfile`.
    - `-t` задаёт тег (имя) образа.
6. **Отправить образ в репозиторий** (например, Docker Hub):
    
    `docker push <имя_образа>`
    
7. **Посмотреть историю слоёв**:
    
    `docker history <имя_образа>`
    

---

### Структура Dockerfile и основные инструкции

8. **FROM `<базовый_образ>`**
    - Определяет, на основе какого готового (или официального) образа строится новый. Тут обычно пишут ОС.
9. **RUN `<команда>`**
    - Запускает указанную команду внутри контейнера на этапе сборки.
    - Пример: `RUN apt-get update && apt-get install -y python3`
10. **COPY `<источник>` `<назначение>`**
    - Копирует файл(ы) из локальной папки (хост) внутрь контейнера.
    - Пример: `COPY app.py /opt/app.py`
11. **ENTRYPOINT `["команда", "аргумент"]`**
    - Задаёт основную команду, которая будет автоматически выполняться при запуске контейнера.
    - Пример: `ENTRYPOINT ["python3", "/opt/app.py"]`

---

### Слой (Layer) в Docker-образе

- Каждый шаг (`FROM`, `RUN`, `COPY` и т.д.) создаёт новый слой.
- Слой хранит **только изменения** относительно предыдущего слоя.
- Повторная сборка:
    - Если в Dockerfile не менялась инструкция, Docker берёт готовый слой из кэша.
    - Если была изменена какая-то команда, пересобираются только слои с этой команды и ниже.

**Преимущества слоёв**:

- Быстрая пересборка при обновлении кода.
- Экономия места за счёт частичного переиспользования слоёв.

---

### Команды из урока и их описание

12. **`docker build . -t <имя>`**
    
    - Собирает Docker-образ из Dockerfile в текущем каталоге (`.`).
    - Параметр `-t` задаёт имя (тег) для образа.
13. **`docker push <имя>`**
    
    - Отправляет (загружает) локально собранный образ в репозиторий (Docker Hub или другой).
14. **`docker history <имя>`**
    
    - Показывает историю слоёв образа (каждый `RUN`, `COPY` и т.д.).
15. **Инструкции для `Dockerfile`:**
    
    - **`FROM <образ>`** — выбрать базовый образ.
    - **`RUN <команда>`** — выполнить команду при сборке.
    - **`COPY <источник> <путь_в_контейнере>`** — копировать файл(ы) внутрь образа.
    - **`ENTRYPOINT ["команда", "аргумент"]`** — задать основной процесс для контейнера.

---

### Дополнение

- **Docker Hub** – наиболее популярный публичный репозиторий образов. Чтобы выкладывать туда образы, нужно завести учётную запись и при `docker push` использовать формат `<логин>/<имя_образа>`.
- **Версионирование** – обычно применяют теги вроде `:latest`, `:1.0`, чтобы иметь несколько версий одного и того же приложения.
- **Оптимизация образа** – перенос часто меняющегося кода (COPY) в конец Dockerfile, чтобы максимизировать переиспользование кэша.

---

**Итог**:

- Для создания своего Docker-образа нужно описать в Dockerfile шаги, аналогичные ручной установке (установка зависимостей, копирование кода, запуск).
- Собрать образ командой `docker build`, а при необходимости — запушить в репозиторий `docker push`.
- Благодаря слоённой архитектуре Docker быстро пересобирает образ при обновлениях кода.